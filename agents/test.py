from utilities.modelRelated import invoke_model
from langchain_core.messages import SystemMessage, HumanMessage

system_prompt = f"""
你是一位专业的表格结构分析与数据重构专家。

【任务说明】
我将依次提供以下两部分内容：
1. 表格的**结构化表头信息**，已经按照层级关系整理好；
2. 一组对应该表头的**CSV数据行**（数据本身为纯数据，无表头）；

【你的目标】
请根据提供的表头结构，为每一行 CSV 数据补上一行其对应的表头信息，从而生成一个新的 CSV 文件，满足如下要求：

【输出要求】
- 每一行数据的**上一行必须是该行对应的完整表头**；
- 表头应严格按照原始结构中的**最底层字段顺序**排列；
- 表头与数据的列数、顺序完全一致；
- 输出结果为纯净的 CSV 格式（英文逗号分隔，每行以换行符结尾）；
- 不要添加任何额外注释或解释性文本；

【输入示例】
表头结构格式如下：
{{
    "{{file_name}}": {{
        "表格结构": {{
            "顶层表头名称": {{
                "二级表头名称": [
                    "字段1",
                    "字段2",
                    ...
                ],
                "更多子表头": [
                    "字段A",
                    "字段B"
                ]
            }}
        }},
        "表格总结": "该表格的主要用途及内容说明..."
    }}
}}

CSV数据示例如下：
csv数据1，csv数据2，csv数据3，...，csv数据10

【输出示例】
字段1,字段2,字段3,...,字段10  
数据1,数据2,数据3,...,数据10  
字段1,字段2,字段3,...,字段10  
数据11,数据12,数据13,...,数据20  
（如此类推）

请注意：
- 只需要处理“最底层字段”，无需在输出中包含中间层级表头；
- 生成的表头行应保持一致性，始终与原始字段顺序匹配。
"""


user_input = f"""
=== 燕云村2024年度党员名册.xlsx 的表格结构 ===
=== 表格结构 ===
{{
  "一品街道燕云村2024年度党员名册": {{
    "基本信息": [
      "序号",
      "姓名",
      "性别",
      "民族",
      "籍贯",
      "学历"
    ],
    "时间信息": [
      "出生日期",
      "年龄",
      "入党时间",
      "转正时间"
    ],
    "身份信息": [
      "公民身份证号",
      "所属支部",
      "电话"
    ]
  }}
}}

=== 表格总结 ===
该表格为重庆市巴南区一品街道燕云村2024年度党员名册，记录了党员的基本信息（姓名、性别等）、时间信息（出生日期、入党时间等）和身份信息（身份证号、所属支部等），适用于村级党组织管理和党员信息统计工作。



=== 燕云村2024年度党员名册.xlsx 的表格数据 ===
15,刘昌明,男,汉族,重庆巴南,初中,1944-06-15,79,510222194406158316,1965-10-23,1966-10-23, 一网格支部委员会,18716423859
16,余献奎,男,汉族,重庆巴南,初中,1952-01-29,71,51022219520129831X,2007-07-30,2008-07-30, 一网格支部委员会,13883406404
17,彭子伦,男,汉族,重庆巴南,初中,1949-10-10,74,510222194910108334,1971-02-15,1971-02-15, 一网格支部委员会,15683752046
18,岑远伦,男,汉族,重庆巴南,初中,1947-01-02,76,510222194701028311,1972-04-11,1972-04-11, 一网格支部委员会,15683117072
19,李  林,男,汉族,重庆巴南,大专,1968-05-26,55,510222196805268319,2006-05-16,2007-05-16, 一网格支部委员会,13883130375
20,李春元,男,汉族,重庆巴南,初中,1954-12-02,69,510222195412028336,1977-06-26,1977-06-26, 一网格支部委员会,13996366647
21,汪顺英,女,汉族,重庆巴南,初中,1949-05-07,74,510222194905158329,1978-08-13,1979-08-13, 一网格支部委员会,18983951517
22,张富华,男,汉族,重庆巴南,初中,1949-02-06,74,510222194902068336,1978-08-27,1979-08-27, 一网格支部委员会,13883994313
23,李  渝,男,汉族,重庆巴南,初中,1966-01-25,57,510222196601258311,2005-06-18,2006-06-18, 一网格支部委员会,15909359432
24,黄文彬,男,汉族,重庆巴南,中专,1975-12-26,48,51022219751226831X,2007-07-30,2008-07-30, 一网格支部委员会,18716405157
25,郭富平,女,汉族,重庆巴南,大专,1971-04-29,52,510225197104294745,2008-06-28,2009-06-28, 一网格支部委员会,15823925784
26,李  顺,男,汉族,重庆巴南,初中,1991-11-05,32,500113199111058317,2014-06-26,2016-06-25, 一网格支部委员会,18908380485
27,李天寿,男,汉族,重庆巴南,初中,1952-08-24,71,510222195208248315,2003-06-18,2004-06-18, 一网格支部委员会,15213428459
28,岑恩平,男,汉族,重庆巴南,中专,19740615,49,510222197406158336,2010-06-10,2011-06-10, 一网格支部委员会,18166565321
29,彭  湃,男,汉族,重庆巴南,本科,1994-01-20,29,50011319940120831X,2018-06-29,2019-06-29, 一网格支部委员会,13883312046
30,岑远贵,男,汉族,重庆北部,初中,1945-01-01,78,510215194501012557,1965-12-25,1966-12-25, 一网格支部委员会,15213281937
32,於常红,女,汉族,重庆巴南,本科,1991-07-08,32,500113199107088329,2019-12-31,2020-12-31, 二网格支部委员会,18723038857
33,龚元林,男,汉族,重庆巴南,大专,1986-11-04,37,50011319861104833X,2007-09-17,2008-09-17, 一网格支部委员会,13983964313
34,赵  胜,男,汉族,重庆巴南,大专,1990-09-14,33,500113199009148316,2012-05-09,2013-05-09, 一网格支部委员会,15023023650
35,岑  亮,男,汉族,重庆巴南,大专,1982-12-02,41,510219198212028337,20230630,预备党员, 一网格支部委员会,15998948989
35,黄  静,女,汉族,重庆巴南,本科,1993-07-18,30,500113199307188340,2017-05-26,2018-05-26, 二网格支部委员会,18225059632
36,王先惠,女,汉族,重庆巴南,大专,1964-02-23,59,510222196402238369,2003-06-18,2004-06-18, 二网格支部委员会,13996097075
37,郭华东,男,汉族,重庆巴南,初中,1946-02-18,77,51022219460218831X,1996-12-22,1997-12-22, 二网格支部委员会,13310217070
38,罗永来,男,汉族,重庆巴南,初中,1981-10-08,42,510219198110088339,2010-06-28,2011-06-28, 二网格支部委员会,13657695858
39,戴云书,男,汉族,重庆巴南,初中,1938-01-20,85,510222193801208315,1965-10-04,1966-10-04, 二网格支部委员会,15923055589
40,杨代君,女,汉族,重庆巴南,中技,1964-09-21,59,510222196409218328,2004-07-29,2005-07-29, 二网格支部委员会,13608348140
41,杨  娜,女,汉族,重庆巴南,大专,1982-05-09,41,510219198205098361,2002-06-18,2003-06-18, 二网格支部委员会,15025397033
42,罗  政,男,汉族,重庆巴南,中专,1993-09-21,30,500113199309219155,2015-09-20,2016-09-20, 一网格支部委员会,17318203332
43,刘光明,男,汉族,重庆巴南,初中,1930-11-17,93,510222193011178318,1960-06-15,1961-06-15, 二网格支部委员会,13452373363
44,邱维财,男,汉族,重庆巴南,初中,1950-08-26,73,510222195008268311,1977-01-08,1977-01-08, 二网格支部委员会,13193188279
45,邱家鹏,男,汉族,重庆巴南,初中,1943-11-04,80,510222194311048317,1980-12-19,1981-12-19, 二网格支部委员会,17843802756
46,邱  珂,女,汉族,重庆巴南,大专,2000-09-30,23,50011320000930832X,2021-11-26,2022-11-26, 二网格支部委员会,15922676449
47,邱维孝,男,汉族,重庆巴南,初中,1949-08-21,74,510222194908218331,1969-09-30,1969-09-30, 二网格支部委员会,17830225552
48,赵  中,男,汉族,重庆巴南,初中,1974-09-22,49,51022219740922831X,1995-08-10,1996-08-10, 二网格支部委员会,18523943154
49,李华瑜,男,汉族,重庆巴南,初中,1943-06-03,80,510222194306038317,1965-10-29,1971-02-19, 二网格支部委员会,18725928308
50,王真志,女,汉族,重庆巴南,初中,1965-02-18,58,51022519650218546X,2002-06-18,2003-06-18, 二网格支部委员会,13594213713
51,刘禹碧,女,汉族,重庆巴南,初中,1927-10-06,96,510222192710068324,1965-10-27,1971-02-19, 二网格支部委员会,15823426408
52,杨远海,男,汉族,重庆巴南,中技,1968-03-19,55,510219196803198339,1990-10-24,1991-10-24, 二网格支部委员会,18623074087
53,杜福康,男,汉族,重庆巴南,初中,1947-11-21,76,510222194711218311,1969-10-10,1969-10-10, 二网格支部委员会,18623662858
54,杜福华,男,汉族,重庆巴南,初中,1952-05-23,71,510222195205238314,1972-04-11,1972-04-11, 二网格支部委员会,15823426408


"""
response = invoke_model(model_name="Pro/deepseek-ai/DeepSeek-V3", messages=[SystemMessage(content=system_prompt), HumanMessage(content=user_input)], temperature=0.2)
print(response)